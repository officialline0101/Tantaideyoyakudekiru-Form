function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const calendar = CalendarApp.getDefaultCalendar();
    calendar.createEvent(data.title, new Date(data.start), new Date(data.end));
    return createCorsResponse({ status: 'success' });
  } catch (error) {
    return createCorsResponse({ status: 'error', message: error.message });
  }
}

function doGet(e) {
  return createCorsResponse({ status: 'ok' });
}

function doOptions(e) {
  return createCorsResponse({});
}

function createCorsResponse(obj) {
  return ContentService.createTextOutput(JSON.stringify(obj))
    .setMimeType(ContentService.MimeType.JSON)
    .setHeader("Access-Control-Allow-Origin", "*")
    .setHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS")
    .setHeader("Access-Control-Allow-Headers", "Content-Type");
}
